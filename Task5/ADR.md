### <a name="_b7urdng99y53"></a>**Название задачи:** Заявка на кредит онлайн
### <a name="_hjk0fkfyohdk"></a>**Автор:** Щуренков Максим
### <a name="_uanumrh8zrui"></a>**Дата:** 19.10.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|UC1|Клиент, сайт|Получение информации об условиях кредита|1. Клиент переходит на сайт банка<br/> 2. Сайт выводит информацию об условиях кредита|
|UC2|Клиент, сайт|Подача заявки на кредит с указанием номера телефона и ФИО|1. Клиент выбирает "взять кредит"<br/> 2. Сайт показывает форму с полями: ФИО, телефон <br/> 3. Клиент отправляет данные<br/> 4. Сайт показывает сообщение об успехе|
|UC3|Клиент, сайт|Мгновенное подтверждение или отказ в кредитовании на основании предоставленных паспортных данных|1. Клиент переходит на сайт банка<br/> 2. Клиент вводит паспортные данные<br/> 3. Сайт показывает предварительное решение|
|UC4|Клиент, интернет-банк|Получение информации об условиях кредита|1. Клиент переходит в интернет-банк<br/> 2. Интернет-банк выводит информацию об условиях кредита|
|UC5|Клиент, интернет-банк|Получение предодобренного предложения по кредиту|1. Клиент переходит в интернет-банк<br/> 2. Интернет-банк выводит информацию о предодобренных условиях кредита|
|UC6|Клиент, интернет-банк|Подача заявки на открытие кредита с номером счета и данными для заявки|1. Клиент выбирает "открыть кредит"<br/> 2. Интернет-банк отображает форму с полями: счёт, данные по заявке <br/> 3. Клиент отправляет данные<br/> 4. Клиент получает СМС с кодом подтверждения и вводит его в открывшемся окне интернет-банка 5. Интернет-банк показывает сообщение об успехе|
|UC7|Система онлайн кредитования, клиент|Получение СМС-нотификаций|1. Изменение статуса заявки<br/> 2. Клиент получает СМС-оповещение|
|UC8|АБС, Сотрудник фронт-офиса|Проверка существования открытой заявки перед оформлением новой|1. Клиент оформил заявку через сайт и пришел в офис<br/> 2. Сотрудник фронт-офиса видит изначальную заявку клиента|
|UC9|Кредитный конвейер, Сотрудник бэк-офиса|Упрощенного путь согласования выдачи кредита по предодобренным заявкам|1. Сотрудник бэк-офиса заходит в заявку<br/> 2. Система показывает, что было предодобренное решение 3. Система позволяет пойти по упрощенному бизнес-процессу|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
|**№**|**Требование**|
| :-: | :- |
|1|**Удобство использования**:<br/> Интерфейс сайта и интернет-банка соответствует корпоративному дизайну|
|2|**Надёжность**:<br/> Режим работы 24/7;<br/> Доступность 99.9%|
|3|**Производительность**:<br/> Отклик - миллисекунды;<br/> Кэширование|
|4|**Поддерживаемость**:<br/> Документирование;<br/> Тестовая среда;<br/> Логирование;<br/> Мониторинг;<br/> Трассировка|
|5|**Информационная безопасность**:<br/> Шифрование трафика;<br/> Авторизация и аутентификация|
|6|**Технологии**:<br/> При выборе стека предпочтение отдаётся технологиям, уже используемым в банке;<br/> Брокер сообщейний - Kafka, но учитывая, что текущая версия платформы интернет-банка с ней несовместима;<br/> Наличие внутренней экспертизы по используемым технологиям |
|7|**Масштабируемость и отказоустойчивость**:<br/> Горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД;<br/> АБС - только вертикальное масштабирование;<br/> Изоляция АБС от прямой нагрузки;<br/> Изоляция системы скоринга от нагрузки по предварительному одобрению кредита в рабочие часы |
|8|**Развёртывание и эксплуатация**:<br/> Все новые сервисы контейнеризированы(Docker);<br/> Все новые сервисы поддерживают оркестрацию(Kubernetes);<br/> CI/CD|
### <a name="_qmphm5d6rvi3"></a>**Решение**

[Диаграмма контекста](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task5/schemas/context/context.plantuml)

![Image Диаграмма контекста](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task5/schemas/context/context.png)

[Диаграмма контейнеров](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task5/schemas/container/container.plantuml)

![Image Диаграмма контейнеров](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task5/schemas/container/container.png)

**Архитектурные решения**:

1. **Переиспользование сервиса AuthService**:

    *Причины переиспользования*:
    - Соответсвует функциональным требованиям
    - Соответсвует нефункциональным требованиям и логике разделения на микросервисы
    - Сокращение трудозатрат

2. **Переиспользование и расширение RateService**:

    *Причины переиспользования*:
    - Соответствует нефункциональным требованиям и логике разделения на микросервисы
    - Сокращение трудозатрат
    
    *Новые функции*:
    - Получение/отправка предодобренных предлождений и ставок
    - Получение/отправка общих условий кредитования

3. **Переиспользование Kafka**:

    *Причины переиспользования*:
    - Соответсвует функциональным требованиям
    - Соответсвует нефункциональным требованиям и логике разделения на микросервисы
    - Сокращение трудозатрат

4. **Переиспользование API Gateway**:

    *Причины переиспользования*:
    - Соответсвует функциональным требованиям
    - Соответсвует нефункциональным требованиям и логике разделения на микросервисы
    - Сокращение трудозатрат

5. **Переиспользование и расширение ABSEventService**:

    *Причины переиспользования*:
    - Соответсвует нефункциональным требованиям и логике разделения на микросервисы
    - Сокращение трудозатрат

    *Новые функции*:
    - Получение и сохранение в АБС заявок от неавторизованных пользователей (асинхронно, учитывая rate limit)

6. **Переиспользование подхода к мониторингу(Grafana), трассировке(Zipkin), Логированию(ELK)**:

    *Причины переиспользования*:
    - Соответсвует функциональным требованиям
    - Соответсвует нефункциональным требованиям и логике разделения на микросервисы
    - Сокращение трудозатрат

7. **StatementCreditService**:

    *Причины*:
    - Соответствие DDD, сервис ответственный только за свою бизнес-функцию
    - Независимость к развитию и масштабированию

    *Сервисы*:
    - StatementCreditService - Обработка заявок на открытие кредита

    *Функции*:
    - Асинхронная передача заявок в Кредитный конвейер от авторизованных пользователей
    - Асинхронная передача заявок в АБС от неавторизованных пользователей
    - Централизованное хранилище первичных заявок на кредит
    - Логирование и трассировка

8. **PreliminaryDecisionService**:

    *Причины*:
    - Соответствие DDD, сервис ответственный только за свою бизнес-функцию
    - Независимость к развитию и масштабированию
    - Функциональное требование: Получить данные из системы скоринга для нового клиента, но есть информация только из общих данных бюро кредитных историй.

    *Сервисы*:
    - PreliminaryDecisionService - Сервис предварительных решений

    *Функции*:
    - Получение данных по кредитной истории
    - Подсчет скоринга
    - Логирование и трассировка

    *Комментарий*:
    Данный сервис может быть репликой существующего сервиса скорингов, но с отключенными функциями анализа данных из АБС и Кредитного конвейера. Т.е. одна кодовая база, но отличие в развертывании и применении конфиг-файлов.
    В текущем решении считаем, что сервис отдельный и использует туже модель, что и сервис скорингов для исключения дублирования логики.

9. **ScoringScheduleService**:

    *Причины*:
    - Соответствие DDD, сервис ответственный только за свою бизнес-функцию
    - Независимость к развитию и масштабированию
    - Защита сервиса скорингов от нагрузки в рабочие часы
    - Контролируемый rate limiting

    *Сервисы*:
    - ScoringScheduleService - Сервис периодического предрасчета скоринга

    *Функции*:
    - Периодический опрос сервиса скорингов для предрасчета
    - Асинхронная передача предрасчетов в RateService 
    - Логирование и трассировка

**Технологический стек**:  

- *Основной язык программирования*: Java Spring

    Обоснование:
    - Поддержка необходимых функций для разрабатываемой системы
    - Широкое распространение в микросервисной архитектуре
    - Наличие экспертизы в компании

- *Основные БД*: PostgreSQL

    Обоснование:
    - Поддержка необходимых функций для разрабатываемой системы
    - Широкое распространение в микросервисной архитектуре
    - Высокая совместимость с Java
    - Наличие экспертизы в компании

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

1. *Отказ от ScoringScheduleService и прямая интеграция с Системой кредитного скоринга*
    - Преимущества:
        - Простота поддержки, ввиду уменьшения количества сервисов
    - Недостатки:
        - Отсутствие защиты от перегрузки Системы кредитного скоринга
        - Несоответствие нефункциональным требованиям
2. *Отказ от переиспользования реализованных решений в системе депозитов*
    - Преимущества:
        - Отсутствие необходимости разбираться в работе существующих сервисов => лёгкость разработки
    - Недостатки:
        - Дублирование логики
        - Увеличение издержек на поддержку и инфраструктуру

**Недостатки, ограничения, риски**

1. Возможны ситуации, когда пользователь оформил заявку через сайт и сразу начал офорление заявки в офисе. Учитывая асинхронный процесс загрузки заявок от неавторизованных пользователей в АБС, может произойти ситуация, когда данная заявка еще не попала в АБС и менеджер фронт-офиса создаст дубликат.
2. Выделение отдельного сервиса PreliminaryDecisionService для предотвращения перегрузки системы кредитного скоринга. Увеличивает сложность поддержки, т.к. необходимо помнить, что у сервиса машинного обучения теперь несколько потребителей.
3. Повышение издержек на поддержку инфраструктуры и сервисов