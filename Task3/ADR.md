### <a name="_b7urdng99y53"></a>**Название задачи:** Открытие депозитов онлайн
### <a name="_hjk0fkfyohdk"></a>**Автор:** Щуренков Максим
### <a name="_uanumrh8zrui"></a>**Дата:** 18.10.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|UC1|Клиент, сайт|Получение списка доступных депозитов с актуальными ставками|1. Клиент переходит на сайт банка<br/> 2. Сайт выводит список доступных депозитов с актуальными ставками|
|UC2|Клиент, сайт|Подача заявки на открытие депозита|1. Клиент выбирает "открыть депозит"<br/> 2. Сайт показывает форму с полями: ФИО, телефон <br/> 3. Клиент отправляет данные<br/> 4. Сайт показывает сообщение об успехе|
|UC3|Сайт, Депозит-сервис, CRM Кол-центр|Передача заявки с сайта в кол-центр|1. Сайт отправляет заявку в Депозит-сервис по HTTPS<br/> 2. Депозит-сервис сохраняет заявку и передает её в CRM Кол-центр<br/> |
|UC4|Менеджер кол-центра, CRM Кол-центр|Обработка заявки с сайта|1. Менеджер кол-центра заходит в CRM<br/> 2. CRM отображает заявки с информацией о номере телефона и ФИО<br/> 3. Менеджер кол-центра звонит клиенту и приглашает в офис |
|UC5|Клиент, интернет-банк|Просмотр списка доступных депозитов с актуальными и персонализированными ставками|1. Клиент авторизуется в интернет-банке<br/>  2. Интернет-банк выводит список доступных депозитов с актуальными и персонализированными ставками|
|UC6|Клиент, интернет-банк|Подача заявки на открытие депозита|1. Клиент выбирает "открыть депозит"<br/> 2. Интернет-банк отображает форму с полями: счёт, сумма депозита <br/> 3. Клиент отправляет данные<br/> 4. Клиент получает СМС с кодом подтверждения и вводит в открывшемся окне интернет-банка 4. Интернет-банк показывает сообщение об успехе|
|UC7|Интернет-банк, Депозит-сервис, АБС|Передача заявки с интернет-банка в АБС|1. Интернет-банк отправляет заявку в Депозит-сервис по HTTPS<br/> 2. Депозит-сервис сохраняет заявку и передает её в АБС<br/> |
|UC8|Менеджер бэк-офиса, АБС|Обработка заявки на депозит|1. Менеджер отдела бэк-офиса заходит в АБС<br/> 2. АБС предоставляет список заявок<br/> 3. Менеджер бэк-офиса проверяет данные клиента<br/> 4. Менеджер бэк-офиса утверждает ставку и открывает депозит |
|UC9|Депозит-сервис, СМС-шлюз|Отправка уведомлений клиенту|1. Депозит сервис отслеживает изменение статусов заявок<br/> 2. Депозит-сервис отправляет уведомление клиенту об открытии депозита |
|UC10|Менеджер бэк-офиса депозитов/кредитов, АБС, сайт, интернет-банк|Управление ставками по депозиту|1. Менеджер заходит в АБС<br/> 2. АБС предоставляет текущий справочник с актуальными ставками по депозитам<br/> 3. Менеджер обновляет ставки<br/> 4. Актуальные ставки выводятся на сайт и интернет-банк |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
|**№**|**Требование**|
| :-: | :- |
|1|**Удобство использования**:<br/> Интерфейс сайта и интернет-банка соответствует корпоративному дизайну|
|2|**Надёжность**:<br/> Режим работы 24/7;<br/> Доступность 99.9%|
|3|**Производительность**:<br/> Отклик - миллисекунды;<br/> Кэширование|
|4|**Поддерживаемость**:<br/> Документирование;<br/> Тестовая среда;<br/> Логирование;<br/> Мониторинг;<br/> Трассировка|
|5|**Информационная безопасность**:<br/> Шифрование трафика;<br/> Авторизация и аутентификация|
|6|**Технологии**:<br/> При выборе стека предпочтение отдаётся технологиям, уже используемым в банке;<br/> Брокер сообщейний - Kafka, но учитывая, что текущая версия платформы интернет-банка с ней несовместима;<br/> Наличие внутренней экспертизы по используемым технологиям |
|7|**Масштабируемость и отказоустойчивость**:<br/> Горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД;<br/> АБС - только вертикальное масштабирование;<br/> Изоляция АБС от прямой нагрузки |
|8|**Развёртывание и эксплуатация**:<br/> Все новые сервисы контейнеризированы(Docker);<br/> Все новые сервисы поддерживают оркестрацию(Kubernetes);<br/> CI/CD|
### <a name="_qmphm5d6rvi3"></a>**Решение**

[Диаграмма контекста](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task3/schemas/context/context.plantuml)

![Image Диаграмма контекста](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task3/schemas/context/context.png)

[Диаграмма контейнеров](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task3/schemas/container/container.plantuml)

![Image Диаграмма контейнеров](https://github.com/Maksina/architecture-pro-standart/blob/analyze/Task3/schemas/container/container.png)

**Архитектурные решения**:

1. **Backend For Frontend**:  
    *Причины*:
    - Сайт и интернет-банк имеют разные потребности, но используют одни и теже сервисы.
        - Сайт - анонимный трафик, минимальный набор данных
        - Интернет-банк - авторизированный пользователь, персонализация, СМС-подтверждения
    - Изоляция от прямого вызова общего API
    *Сервисы*:
    - SiteBFF - BFF для веб-интерфейса сайта
    - InternetBankBFF - BFF для веб-интерфейса интернет-банка
    *Функции*:
    - Маршрутизация запросов
    - Агрегация данных
    - Адаптация API под каждый клиентский интерфейс
    - Аутентификация и авторизация

2. **API Gateway**:  
    *Причины*:
    - Единый входной шлюз для микросервисов
    - Исключение дублирования логики безопасности в каждом микросервисе
    *Функции*:
    - Аутентификации
    - Rate limiting
    - Маршрутизации запросов
    - Логирование и трассировка

3. **RateService**:   
    *Причины*:
    - Соответствие DDD, сервис ответственный только за свою бизнес-функцию
    - Независимость к развитию и масштабированию
    *Сервисы*:
    - RateService - Обработка депозитных ставок, включая персональные
    *Функции*:
    - Асинхронное получение ставок из АБС
    - Быстрая публикация ставок по API (REST API + Redis)
    - Логирование и трассировка

4. **StatementService**:   
    *Причины*:
    - Соответствие DDD, сервис ответственный только за свою бизнес-функцию
    - Независимость к развитию и масштабированию
    *Сервисы*:
    - StatementService - Обработка заявок на открытие депозита
    *Функции*:
    - Асинхронная передача заявок в АБС от авторизованных пользователей
    - Передача обращений в Кол-центр от неавторизованных пользователей
    - Централизованное хранилище первичных заявок на депозит
    - Логирование и трассировка

5. **NotificationService**:   
    *Причины*:
    - Соответствие DDD, сервис ответственный только за свою бизнес-функцию
    - Независимость к развитию и масштабированию
    *Сервисы*:
    - NotificationService - Сервис управления оповещениями
    *Функции*:
    - Отправка СМС-подтверждений
    - Реакция на события изменения статусов заявки в части уведомлений
    - Централизованное хранилище уведомлений
    - Логирование и трассировка

6. **PostgreSQL**:  
    *Причины*:
    - Уже используется в банка
    - Поддержка ACID и надежность
    - Высокая совместимость с Java-стеком
    *БД*:
    - StatementServiceDB - Хранение информации о заявках
    - StatementServiceDB - Хранение информации об оповещениях
    *Функции*:
    - Хранение первичных заявок из StatementService
    - Хранение истории уведомлений из NotificationService

7. **Redis**:  
    *Причины*:
    - Высокая скорость чтения и записи
    - Встроенная поддержка TTL
    - Подходит для хранения часто меняющихся данных
    *БД*:
    - RateServiceDB - Хранение информации о депозитных ставках, включая персональные
    *Функции*:
    - Кэширование базовых и персонализированных ставок по депозитам из RateSerivce
    - Быстрый доступ к актуальным ставкам из RateSerivce

8. **Шина событий**:  
    *Причины*:
    - Поддержка асинхронной, отказоустойчивой интеграции
    - Горизонтальное масшитабирование
    - Предпочтение компании
    *Технологии*:
    - Kafka - Обработка событий
    *Функции*:
    - Хранение событий о первичных заявках (для АБС)
    - Хранение событий об изменениях статуса заявки по депозиту (для сервиса оповещений)
    - Хранение событий об изменениях в ставках по депозиту (для сервиса ставок)
    - Хранение трассировочных данных (для сквозной трассировки)

9. **ABSEventService**:   
    *Причины*:
    - Защита АБС от прямого доступа
    - Контролируемый rate limiting
    *Сервисы*:
    - ABSEventService - Сервис взаимодействия с АБС
    *Функции*:
    - Потребление событий из Kafka (новые заявки)
    - Публикация событий об изменении ставок и статуса заявок
    - Логирование и трассировка

**Технологический стек**:  
- *Основной язык программирования*: Java Spring
    Обоснование:
    - Поддержка необходимых функций для разрабатываемой системы
    - Широкое распространение в микросервисной архитектуре
    - Наличие экспертизы в компании
- *Основные БД*: PostgreSQL
    Обоснование:
    - Поддержка необходимых функций для разрабатываемой системы
    - Широкое распространение в микросервисной архитектуре
    - Высокая совместимость с Java
    - Наличие экспертизы в компании
- *Шина событий*: Kafka
    Обоснование:
    - Поддержка необходимых функций для разрабатываемой системы
    - Широкое распространение в микросервисной архитектуре
    - Предпочтение компании

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

1. *Отказ от ABSEventService и прямая интеграция с АБС*
    - Преимущества:
        - Простота поддержки, ввиду уменьшения количества сервисов
    - Недостатки:
        - Отсутствие защиты от перегрузки АБС
        - Жесткая связность компонентов на АБС => изменения в АБС требуют изменений в StatementService
2. *Отказ от BFF и прямая интеграция веб-интерфейсов с API Gateway*
    - Преимущества:
        - Простота поддержки, ввиду уменьшения количества сервисов
    - Недостатки: 
        - Повышение риска утечки данных (например, утечка персонализированных данных на сайт)
        - Масштабирование - сайт и интернет-банк могут иметь разную нагрузку
3. *Отказ от Event-Driven архитектуры и переход на синхронные интеграции*
    - Преимущества:
        - Простота отладки, т.к. синхронные запросы проще анализировать
        - Отсутствие необходимости поддержки Kafka
    - Недостатки:
        - Жесткая связность компонентов => возможны каскадные сбои
        - Увеличение нагрузки на сервисы

**Недостатки, ограничения, риски**

1. АБС - центр принятия решений и мастер-данных. Сбой в АБС или в ABSEventService может привести к блокировке всего бизнес-процесса
2. Потребность в новой экспертизе по Kafka, Redis, DevOps
3. Повышение издержек на поддержку инфраструктуры и сервисов

